# æµ‹è¯•æŒ‡å—æ€»è§ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›äº† RWA å€Ÿè´·å¹³å°æ‰€æœ‰æµ‹è¯•æŒ‡å—çš„ç´¢å¼•å’Œæ€»è§ˆã€‚æµ‹è¯•æŒ‡å—æŒ‰ç…§æ¨¡å—å’ŒåŠŸèƒ½åˆ†ç±»ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ‰¾åˆ°ç›¸å…³çš„æµ‹è¯•æ–‡æ¡£ã€‚

## ğŸ“š æµ‹è¯•æŒ‡å—åˆ—è¡¨

### æ ¸å¿ƒæ¶æ„æµ‹è¯•

1. **[VaultView æµ‹è¯•æŒ‡å—](./vaultview-testing-guide.md)**
   - VaultView åŒæ¶æ„æ™ºèƒ½åè°ƒå™¨æµ‹è¯•
   - äº‹ä»¶é©±åŠ¨å’Œ View å±‚ç¼“å­˜æµ‹è¯•
   - ç”¨æˆ·æ“ä½œå¤„ç†å’Œæ¨¡å—åˆ†å‘æµ‹è¯•

2. **[Registry æµ‹è¯•æŒ‡å—](./registry-testing-guide.md)**
   - Registry æ¨¡å—æ³¨å†Œä¸­å¿ƒæµ‹è¯•
   - æ¨¡å—æ³¨å†Œã€å‡çº§å’ŒæŸ¥è¯¢æµ‹è¯•
   - æƒé™ç®¡ç†å’Œå»¶è¿Ÿå‡çº§æµ‹è¯•

### ä¸šåŠ¡æ¨¡å—æµ‹è¯•

3. **[æ¸…ç®—ç³»ç»Ÿæµ‹è¯•æŒ‡å—](./liquidation-testing-guide.md)**
   - æ¸…ç®—ç«¯åˆ°ç«¯æµ‹è¯•
   - æ¸…ç®—é£é™©ç®¡ç†æµ‹è¯•
   - æ¸…ç®—æŠµæŠ¼ç‰©å’Œå€ºåŠ¡ç®¡ç†æµ‹è¯•

4. **[Reward æµ‹è¯•æŒ‡å—](./reward-testing-guide.md)**
   - å¥–åŠ±ç³»ç»Ÿç«¯åˆ°ç«¯æµ‹è¯•
   - ç§¯åˆ†è®¡ç®—å’Œå‘æ”¾æµ‹è¯•
   - ç”¨æˆ·ç­‰çº§å’Œæ¶ˆè´¹æµ‹è¯•

5. **[Vault æ¨¡å—æµ‹è¯•æŒ‡å—](./vault-modules-testing-guide.md)**
   - ä¸šåŠ¡é€»è¾‘æµ‹è¯•
   - æŠµæŠ¼ç®¡ç†å™¨æµ‹è¯•
   - ä¿è¯é‡‘ç®¡ç†å™¨æµ‹è¯•

### åŸºç¡€è®¾æ–½æµ‹è¯•

6. **[Core æ¨¡å—æµ‹è¯•æŒ‡å—](./core-modules-testing-guide.md)**
   - ä»·æ ¼é¢„è¨€æœºæµ‹è¯•
   - è´¹ç”¨è·¯ç”±æµ‹è¯•
   - å€Ÿè´· NFT æµ‹è¯•

7. **[View å±‚æµ‹è¯•æŒ‡å—](./view-layer-testing-guide.md)**
   - ç”¨æˆ·è§†å›¾æµ‹è¯•
   - ç³»ç»Ÿè§†å›¾æµ‹è¯•
   - æ‰¹é‡æŸ¥è¯¢æµ‹è¯•

8. **[ç«¯åˆ°ç«¯æµ‹è¯•æŒ‡å—](./end-to-end-testing-guide.md)**
   - ç»¼åˆç«¯åˆ°ç«¯æµ‹è¯•
   - ç”¨æˆ·å®Œæ•´è·¯å¾„æµ‹è¯•
   - æ‰¹é‡æ“ä½œå’Œé£é™©ç›‘æ§æµ‹è¯•

9. **[LendingEngine æµ‹è¯•æŒ‡å—](./lending-engine-testing-guide.md)**
   - å€Ÿè´·å¼•æ“æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
   - æƒé™æ§åˆ¶å’Œé›†æˆæµ‹è¯•

10. **[StatisticsView æµ‹è¯•æŒ‡å—](./statistics-view-testing-guide.md)**
    - æ´»è·ƒç”¨æˆ·ç»Ÿè®¡æµ‹è¯•
    - ä¿è¯é‡‘èšåˆæµ‹è¯•
    - æ•°æ®è¿ç§»æµ‹è¯•

## ğŸ—‚ï¸ æµ‹è¯•æ–‡ä»¶åˆ†ç±»

### æŒ‰æ¨¡å—åˆ†ç±»

```
test/
â”œâ”€â”€ VaultView.test.ts                    # VaultView æ ¸å¿ƒæµ‹è¯•
â”œâ”€â”€ Registry*.test.ts                    # Registry ç›¸å…³æµ‹è¯•
â”œâ”€â”€ Vault/
â”‚   â”œâ”€â”€ liquidation/                     # æ¸…ç®—æ¨¡å—æµ‹è¯•
â”‚   â”œâ”€â”€ modules/                          # Vault ä¸šåŠ¡æ¨¡å—æµ‹è¯•
â”‚   â””â”€â”€ view/                            # View å±‚æµ‹è¯•
â”œâ”€â”€ Reward/                              # Reward æ¨¡å—æµ‹è¯•
â”œâ”€â”€ core/                                # Core æ¨¡å—æµ‹è¯•
â””â”€â”€ ...                                  # å…¶ä»–æµ‹è¯•
```

### æŒ‰æµ‹è¯•ç±»å‹åˆ†ç±»

- **å•å…ƒæµ‹è¯•**: å•ä¸ªåˆçº¦æˆ–å‡½æ•°çš„æµ‹è¯•
- **é›†æˆæµ‹è¯•**: å¤šä¸ªæ¨¡å—åä½œçš„æµ‹è¯•
- **ç«¯åˆ°ç«¯æµ‹è¯• (E2E)**: å®Œæ•´ä¸šåŠ¡æµç¨‹çš„æµ‹è¯•
- **å®‰å…¨æµ‹è¯•**: å®‰å…¨æ¼æ´å’Œæ”»å‡»åœºæ™¯æµ‹è¯•
- **æ€§èƒ½æµ‹è¯•**: Gas æ¶ˆè€—å’Œæ€§èƒ½ä¼˜åŒ–æµ‹è¯•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npx hardhat test

# è¿è¡Œç‰¹å®šç›®å½•çš„æµ‹è¯•
npx hardhat test test/Vault/
npx hardhat test test/Reward/
npx hardhat test test/core/
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶

```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
npx hardhat test test/VaultView.test.ts
npx hardhat test test/Registry.test.ts
```

### è¿è¡Œç‰¹å®šæµ‹è¯•ç”¨ä¾‹

```bash
# ä½¿ç”¨ --grep è¿‡æ»¤æµ‹è¯•
npx hardhat test --grep "åº”è¯¥æ­£ç¡®åˆå§‹åŒ–"
npx hardhat test test/VaultView.test.ts --grep "æƒé™æ§åˆ¶æµ‹è¯•"
```

### ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡

```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npx hardhat coverage

# æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š
open coverage/index.html
```

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

### æµ‹è¯•æ–‡ä»¶æ•°é‡

- **æ€»æµ‹è¯•æ–‡ä»¶æ•°**: 70+
- **æ ¸å¿ƒæ¶æ„æµ‹è¯•**: 10+
- **ä¸šåŠ¡æ¨¡å—æµ‹è¯•**: 30+
- **åŸºç¡€è®¾æ–½æµ‹è¯•**: 20+
- **ç«¯åˆ°ç«¯æµ‹è¯•**: 5+

### æµ‹è¯•è¦†ç›–èŒƒå›´

- **è¯­å¥è¦†ç›–ç‡**: > 80%
- **åˆ†æ”¯è¦†ç›–ç‡**: > 75%
- **å‡½æ•°è¦†ç›–ç‡**: > 85%
- **è¡Œè¦†ç›–ç‡**: > 80%

## ğŸ”§ æµ‹è¯•å·¥å…·å’Œæ¡†æ¶

### ä¸»è¦å·¥å…·

- **Hardhat**: å¼€å‘å’Œæµ‹è¯•æ¡†æ¶
- **Chai**: æ–­è¨€åº“
- **Ethers.js**: ä»¥å¤ªåŠäº¤äº’åº“
- **@nomicfoundation/hardhat-network-helpers**: æµ‹è¯•è¾…åŠ©å·¥å…·

### æµ‹è¯•æ¨¡å¼

- **å¹¶è¡Œæµ‹è¯•**: Hardhat é»˜è®¤å¹¶è¡Œè¿è¡Œæµ‹è¯•
- **å¿«ç…§æµ‹è¯•**: ä½¿ç”¨ `loadFixture` è¿›è¡ŒçŠ¶æ€å¿«ç…§
- **Gas æŠ¥å‘Š**: ä½¿ç”¨ `REPORT_GAS=true` ç”Ÿæˆ Gas æŠ¥å‘Š

## ğŸ“ ç¼–å†™æ–°æµ‹è¯•

### æµ‹è¯•æ–‡ä»¶å‘½åè§„èŒƒ

- å•å…ƒæµ‹è¯•: `{ContractName}.test.ts`
- é›†æˆæµ‹è¯•: `{ModuleName}.integration.test.ts`
- ç«¯åˆ°ç«¯æµ‹è¯•: `{FeatureName}.e2e.test.ts`
- å®‰å…¨æµ‹è¯•: `{ContractName}.security.test.ts`

### æµ‹è¯•ç»“æ„æ¨¡æ¿

```typescript
import { expect } from 'chai';
import hardhat from 'hardhat';
const { ethers } = hardhat;
import { loadFixture } from '@nomicfoundation/hardhat-network-helpers';

describe('ContractName â€“ åŠŸèƒ½æè¿°', function () {
  // æµ‹è¯•å¸¸é‡
  const ZERO_ADDRESS = '0x0000000000000000000000000000000000000000';
  
  // æµ‹è¯•å˜é‡
  let contract: Contract;
  let owner: SignerWithAddress;
  let user: SignerWithAddress;

  // éƒ¨ç½² Fixture
  async function deployFixture() {
    const [ownerSigner, userSigner] = await ethers.getSigners();
    // ... éƒ¨ç½²åˆçº¦
    return { contract, owner, user };
  }

  beforeEach(async function () {
    const fixture = await loadFixture(deployFixture);
    Object.assign(this, fixture);
  });

  describe('åŠŸèƒ½æµ‹è¯•', function () {
    it('åº”è¯¥æ­£ç¡®æ‰§è¡ŒåŠŸèƒ½', async function () {
      // æµ‹è¯•ä»£ç 
    });
  });
});
```

## ğŸ› å¸¸è§é—®é¢˜

### æµ‹è¯•å¤±è´¥

1. **æ¨¡å—æœªæ³¨å†Œ**: ç¡®ä¿åœ¨ Fixture ä¸­æ³¨å†Œæ‰€æœ‰å¿…éœ€çš„æ¨¡å—
2. **æƒé™ä¸è¶³**: ç¡®ä¿æˆäºˆå¿…è¦çš„æƒé™
3. **é›¶åœ°å€é”™è¯¯**: ä½¿ç”¨æœ‰æ•ˆçš„åœ°å€
4. **Gas ä¸è¶³**: å¢åŠ  Gas limit æˆ–ä¼˜åŒ–æµ‹è¯•

### è°ƒè¯•æŠ€å·§

1. ä½¿ç”¨ `console.log` è¾“å‡ºè°ƒè¯•ä¿¡æ¯
2. ä½¿ç”¨ `--verbose` æ ‡å¿—æŸ¥çœ‹è¯¦ç»†è¾“å‡º
3. ä½¿ç”¨ `--grep` è¿‡æ»¤ç‰¹å®šæµ‹è¯•
4. ä½¿ç”¨ Hardhat console è¿›è¡Œäº¤äº’å¼è°ƒè¯•

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•æ–‡ä»¶æ ‡å‡†](../test-file-standards.md) - æµ‹è¯•æ–‡ä»¶ç¼–å†™è§„èŒƒ
- [æ¶æ„æŒ‡å—](../Architecture-Guide.md) - ç³»ç»Ÿæ¶æ„è¯´æ˜
- [å¹³å°é€»è¾‘æ–‡æ¡£](../PlatformLogic.md) - å¹³å°æ•´ä½“é€»è¾‘
- [æ™ºèƒ½åˆçº¦æ ‡å‡†](../SmartContractStandard.md) - ä»£ç è§„èŒƒ

## ğŸ¯ æµ‹è¯•æœ€ä½³å®è·µ

1. **ä½¿ç”¨ loadFixture**: é¿å…æµ‹è¯•ä¹‹é—´çš„çŠ¶æ€æ±¡æŸ“
2. **æ¸…æ™°çš„æµ‹è¯•æè¿°**: ä½¿ç”¨ä¸­æ–‡æè¿°æµ‹è¯•ç›®æ ‡
3. **å®Œæ•´çš„æ–­è¨€**: éªŒè¯æ‰€æœ‰ç›¸å…³çŠ¶æ€å˜åŒ–
4. **äº‹ä»¶éªŒè¯**: éªŒè¯é‡è¦äº‹ä»¶çš„è§¦å‘
5. **é”™è¯¯å¤„ç†**: æµ‹è¯•é”™è¯¯åœºæ™¯å’Œè¾¹ç•Œæ¡ä»¶
6. **Gas ä¼˜åŒ–**: åœ¨æµ‹è¯•ä¸­è€ƒè™‘ Gas æ¶ˆè€—
7. **å¹¶è¡Œæµ‹è¯•**: åˆ©ç”¨ Hardhat çš„å¹¶è¡Œæµ‹è¯•èƒ½åŠ›
8. **è¦†ç›–ç‡ç›®æ ‡**: ä¿æŒé«˜æµ‹è¯•è¦†ç›–ç‡

## ğŸ“ˆ æŒç»­æ”¹è¿›

### æµ‹è¯•è´¨é‡æŒ‡æ ‡

- **è¦†ç›–ç‡**: æŒç»­æé«˜æµ‹è¯•è¦†ç›–ç‡
- **æ‰§è¡Œæ—¶é—´**: ä¼˜åŒ–æµ‹è¯•æ‰§è¡Œæ—¶é—´
- **ç¨³å®šæ€§**: å‡å°‘æµ‹è¯•å¤±è´¥ç‡
- **å¯ç»´æŠ¤æ€§**: æé«˜æµ‹è¯•ä»£ç çš„å¯ç»´æŠ¤æ€§

### å®šæœŸå®¡æŸ¥

- å®šæœŸå®¡æŸ¥æµ‹è¯•è¦†ç›–ç‡
- æ›´æ–°è¿‡æ—¶çš„æµ‹è¯•
- æ·»åŠ æ–°åŠŸèƒ½çš„æµ‹è¯•
- ä¼˜åŒ–æ…¢é€Ÿæµ‹è¯•

---

**ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ  
**ç»´æŠ¤è€…**: RWA Lending Platform Team
